generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

enum TaskStatus {
  queued
  parsing
  calculating
  analyzing
  generating_charts
  completed
  failed
}

model AnalysisTask {
  id             String     @id @default(uuid())
  status         TaskStatus @default(queued)
  progress       Int        @default(0)
  currentStep    String?
  error          String?

  fileId         String
  fileName       String
  fileSize       Int
  fileUrl        String?    // Vercel Blob URL 或本地文件路径
  columnMapping  String

  aiProvider     String   @default("claude")
  aiConfig       String?  // AI 配置（JSON 字符串）
  generateTopics Boolean  @default(true)

  resultData     String?

  reportPath     String?
  excelPath      String?
  chartPaths     String?

  recordCount    Int?
  viralCount     Int?

  accountName    String?   // 账号名称

  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  completedAt    DateTime?

  @@index([status])
  @@index([createdAt])
  @@index([completedAt])
  @@map("analysis_tasks")
}
